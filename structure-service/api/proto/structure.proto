syntax = "proto3";

package structure;

option go_package = "structure-service/api/proto;structurepb";

// StructureService предоставляет методы для работы со структурой вузов
service StructureService {
  // GetAllUniversities получает все университеты с пагинацией
  rpc GetAllUniversities(GetAllUniversitiesRequest) returns (GetAllUniversitiesResponse);
  
  // CreateUniversity создает новый университет
  rpc CreateUniversity(CreateUniversityRequest) returns (CreateUniversityResponse);
  
  // GetUniversityByID получает вуз по ID
  rpc GetUniversityByID(GetUniversityByIDRequest) returns (GetUniversityByIDResponse);
  
  // GetUniversityByINN получает вуз по ИНН
  rpc GetUniversityByINN(GetUniversityByINNRequest) returns (GetUniversityByINNResponse);
  
  // GetUniversityStructure получает структуру университета
  rpc GetUniversityStructure(GetUniversityStructureRequest) returns (GetUniversityStructureResponse);
  
  // UpdateUniversityName обновляет название университета
  rpc UpdateUniversityName(UpdateUniversityNameRequest) returns (UpdateUniversityNameResponse);
  
  // CreateOrGetUniversity создает или получает вуз по ИНН/КПП
  rpc CreateOrGetUniversity(CreateOrGetUniversityRequest) returns (CreateOrGetUniversityResponse);
  
  // CreateStructure создает полную структуру (университет, филиал, факультет, группа)
  rpc CreateStructure(CreateStructureRequest) returns (CreateStructureResponse);
  
  // ImportExcel импортирует данные из Excel файла
  rpc ImportExcel(ImportExcelRequest) returns (ImportExcelResponse);
  
  // UpdateBranchName обновляет название филиала
  rpc UpdateBranchName(UpdateBranchNameRequest) returns (UpdateBranchNameResponse);
  
  // UpdateFacultyName обновляет название факультета
  rpc UpdateFacultyName(UpdateFacultyNameRequest) returns (UpdateFacultyNameResponse);
  
  // UpdateGroupName обновляет название группы
  rpc UpdateGroupName(UpdateGroupNameRequest) returns (UpdateGroupNameResponse);
  
  // LinkGroupToChat связывает группу с чатом
  rpc LinkGroupToChat(LinkGroupToChatRequest) returns (LinkGroupToChatResponse);
  
  // GetAllDepartmentManagers получает всех менеджеров департаментов
  rpc GetAllDepartmentManagers(GetAllDepartmentManagersRequest) returns (GetAllDepartmentManagersResponse);
  
  // CreateDepartmentManager назначает оператора департамента
  rpc CreateDepartmentManager(CreateDepartmentManagerRequest) returns (CreateDepartmentManagerResponse);
  
  // RemoveDepartmentManager удаляет оператора департамента
  rpc RemoveDepartmentManager(RemoveDepartmentManagerRequest) returns (RemoveDepartmentManagerResponse);
  
  // Health проверяет состояние сервиса
  rpc Health(HealthRequest) returns (HealthResponse);
}

// University list messages
message GetAllUniversitiesRequest {
  int32 page = 1;
  int32 limit = 2;
  string sort_by = 3;
  string sort_order = 4;
}

message GetAllUniversitiesResponse {
  repeated University universities = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
  string error = 5;
}

message CreateUniversityRequest {
  string name = 1;
  string inn = 2;
  string kpp = 3;
  string foiv = 4;
}

message CreateUniversityResponse {
  University university = 1;
  string error = 2;
}

message GetUniversityByIDRequest {
  int64 id = 1;
}

message GetUniversityByIDResponse {
  University university = 1;
  string error = 2;
}

message GetUniversityByINNRequest {
  string inn = 1;
}

message GetUniversityByINNResponse {
  University university = 1;
  string error = 2;
}

message GetUniversityStructureRequest {
  int64 university_id = 1;
}

message GetUniversityStructureResponse {
  UniversityStructure structure = 1;
  string error = 2;
}

message UpdateUniversityNameRequest {
  int64 university_id = 1;
  string name = 2;
}

message UpdateUniversityNameResponse {
  University university = 1;
  string error = 2;
}

message CreateOrGetUniversityRequest {
  string inn = 1;
  string kpp = 2;
  string name = 3;
  string foiv = 4;
}

message CreateOrGetUniversityResponse {
  University university = 1;
  string error = 2;
}

message University {
  int64 id = 1;
  string name = 2;
  string inn = 3;
  string kpp = 4;
  string foiv = 5;
  string created_at = 6;
  string updated_at = 7;
}

message UniversityStructure {
  University university = 1;
  repeated Branch branches = 2;
}

message Branch {
  int64 id = 1;
  string name = 2;
  int64 university_id = 3;
  repeated Faculty faculties = 4;
  string created_at = 5;
  string updated_at = 6;
}

message Faculty {
  int64 id = 1;
  string name = 2;
  int64 branch_id = 3;
  repeated Group groups = 4;
  string created_at = 5;
  string updated_at = 6;
}

message Group {
  int64 id = 1;
  string number = 2;
  int32 course = 3;
  int64 faculty_id = 4;
  optional int64 chat_id = 5;
  string created_at = 6;
  string updated_at = 7;
}

// Structure creation messages
message CreateStructureRequest {
  string inn = 1;
  string kpp = 2;
  string foiv = 3;
  string org_name = 4;
  string branch_name = 5;
  string faculty_name = 6;
  int32 course = 7;
  string group_number = 8;
}

message CreateStructureResponse {
  int64 university_id = 1;
  optional int64 branch_id = 2;
  optional int64 faculty_id = 3;
  int64 group_id = 4;
  string error = 5;
}

// Import messages
message ImportExcelRequest {
  bytes file_data = 1;
  string filename = 2;
}

message ImportExcelResponse {
  int32 processed_rows = 1;
  int32 successful_rows = 2;
  int32 failed_rows = 3;
  repeated string errors = 4;
  string error = 5;
}

// Update name messages
message UpdateBranchNameRequest {
  int64 branch_id = 1;
  string name = 2;
}

message UpdateBranchNameResponse {
  Branch branch = 1;
  string error = 2;
}

message UpdateFacultyNameRequest {
  int64 faculty_id = 1;
  string name = 2;
}

message UpdateFacultyNameResponse {
  Faculty faculty = 1;
  string error = 2;
}

message UpdateGroupNameRequest {
  int64 group_id = 1;
  string number = 2;
}

message UpdateGroupNameResponse {
  Group group = 1;
  string error = 2;
}

message LinkGroupToChatRequest {
  int64 group_id = 1;
  int64 chat_id = 2;
}

message LinkGroupToChatResponse {
  bool success = 1;
  string error = 2;
}

// Department manager messages
message GetAllDepartmentManagersRequest {
  int32 page = 1;
  int32 limit = 2;
}

message GetAllDepartmentManagersResponse {
  repeated DepartmentManager managers = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
  string error = 5;
}

message CreateDepartmentManagerRequest {
  string user_id = 1;
  int64 department_id = 2;
}

message CreateDepartmentManagerResponse {
  DepartmentManager manager = 1;
  string error = 2;
}

message RemoveDepartmentManagerRequest {
  int64 manager_id = 1;
}

message RemoveDepartmentManagerResponse {
  bool success = 1;
  string error = 2;
}

message DepartmentManager {
  int64 id = 1;
  string user_id = 2;
  int64 department_id = 3;
  string created_at = 4;
}

// Health messages
message HealthRequest {
}

message HealthResponse {
  string status = 1;
}