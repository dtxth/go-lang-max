# MAX API - POST /internal/users

## Описание
Для запуска внутреннего миниприложения необходимо получать информацию о userId (maxId).

## Endpoint
```
POST /internal/users
```

## Авторизация
Токен кладется в заголовок Authorization:
```
Authorization: ••••••
```

**access_token** - токен бота

## Параметры запроса

| Параметр | Тип данных | Описание |
|----------|------------|----------|
| phone_numbers | array<string> | Номера телефонов |

**Ограничения:**
- Не больше 100 идентификаторов за один запрос

### Пример запроса
```json
{
  "phone_numbers": [
    "+79991234567",
    "+79887654321",
    "89001112233"
  ]
}
```

## Параметры ответа

### Успешный ответ

| Параметр | Тип данных | Описание |
|----------|------------|----------|
| users | array<object> | Объект с результатами |

### Объект user

| Параметр | Тип данных | Описание |
|----------|------------|----------|
| user_id | int64 | Идентификатор пользователя |
| first_name | string | Имя пользователя |
| last_name | string | Фамилия пользователя |
| is_bot | boolean | true - бот, false - пользователь |
| username | string | Шортнейм пользователя |
| avatar_url | string | URL-адрес фотографии профиля пользователя |
| full_avatar_url | string | URL-адрес фотографии профиля пользователя в большом разрешении |
| link | string | Ссылка на пользователя, по которой клиент сможет открыть диалог с пользователем |
| phone_number | string | Номер телефона, привязанный к Max |
| failed_phone_numbers | array<string> | Идентификаторы пользователей, по которым не удалось получить информацию |

### Пример ответа
```json
{
  "users": [
    {
      "user_id": 123456789,
      "first_name": "Иван",
      "last_name": "Иванов",
      "is_bot": false,
      "username": "ivan_ivanov",
      "avatar_url": "https://max.ru/avatars/123456789_small.jpg",
      "full_avatar_url": "https://max.ru/avatars/123456789_full.jpg",
      "link": "max.ru/ivan_ivanov",
      "phone_number": "+79991234567"
    },
    {
      "user_id": 987654321,
      "first_name": "Мария",
      "last_name": "Петрова",
      "is_bot": false,
      "username": "",
      "avatar_url": "https://max.ru/avatars/987654321_small.jpg",
      "full_avatar_url": "https://max.ru/avatars/987654321_full.jpg",
      "link": "max.ru/u/abc123hash",
      "phone_number": "+79887654321"
    }
  ],
  "failed_phone_numbers": [
    "89001112233"
  ]
}
```

## Правила формирования ссылок

Поле `link` формируется по следующему правилу:

- **ЕСЛИ** есть шортнейм → `max.ru/<short_name>`
- **ИНАЧЕ** → `max.ru/u/<hash>`

Пользователи без шортнейма имеют ссылку вида `max.ru/u/<hash>`, а с шортнеймом `max.ru/<short_name>`.

Чтобы клиент сразу ссылку воспринял как переход к диалогу, бэкэнд формирует ответ для этого поля по указанному правилу.

## Ошибки

| Код ошибки | Описание |
|------------|----------|
| proto.payload | Один или несколько параметров отсутствуют |
| method.not.found | Нет права для выполнения такого действия |

### Пример ошибки
```json
{
  "error": "proto.payload",
  "message": "phone_numbers parameter is required"
}
```

## Использование в проекте

Этот endpoint может быть использован для:

1. **Получения профилей пользователей** - имена, фамилии, аватары
2. **Batch операций** - обработка до 100 номеров за раз
3. **Валидации номеров** - проверка существования в MAX Messenger
4. **Интеграции с Employee Service** - получение полных профилей при создании сотрудников

## Связь с текущей архитектурой

Этот endpoint решает текущую проблему в `maxbot-service`, где метод `GetUserProfileByPhone` возвращает пустые имена:

```go
// Текущая реализация возвращает пустые имена
return &domain.UserProfile{
    MaxID:     maxID,
    Phone:     normalized,
    FirstName: "", // Пустое - MAX API пока не предоставляет
    LastName:  "", // Пустое - MAX API пока не предоставляет
}, nil
```

С использованием `/internal/users` можно получить полную информацию о пользователях.