# üì¶ –ò–º–ø–æ—Ä—Ç –±–æ–ª—å—à–∏—Ö Excel —Ñ–∞–π–ª–æ–≤ (20+ –ú–ë)

## ‚úÖ –í–∞—à —Ñ–∞–π–ª 20 –ú–ë –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è!

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –¥–æ **50 –ú–ë** (~250,000 —Å—Ç—Ä–æ–∫).

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
./apply_excel_migration.sh

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ –ø–∞–º—è—Ç–∏
docker-compose up -d --build migration-service chat-service
```

### 2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª

```bash
curl -X POST http://localhost:8084/migration/excel \
  -F "file=@–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —á–∞—Ç–æ–≤ –≥—Ä—É–ø–ø –ú–ì–¢–£ –≤ –ú–ê–• 17.11.25_–ò–¢–û–ì.xlsx"
```

–û—Ç–≤–µ—Ç:
```json
{
  "job_id": 1,
  "status": "running"
}
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å

```bash
# –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
watch -n 10 'curl -s http://localhost:8084/migration/jobs/1 | jq'
```

–í—ã–≤–æ–¥:
```json
{
  "id": 1,
  "source_type": "excel",
  "status": "running",
  "total": 100000,
  "processed": 45000,
  "failed": 120,
  "created_at": "2024-12-03T10:00:00Z",
  "updated_at": "2024-12-03T10:02:30Z"
}
```

## ‚è±Ô∏è –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –î–ª—è —Ñ–∞–π–ª–∞ 20 –ú–ë (~100,000 —Å—Ç—Ä–æ–∫):

- **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞:** 5-10 —Å–µ–∫
- **–ü–∞—Ä—Å–∏–Ω–≥ Excel:** 10-15 —Å–µ–∫
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:** 1-2 –º–∏–Ω—É—Ç—ã
- **–ò–¢–û–ì–û:** 1.5-2.5 –º–∏–Ω—É—Ç—ã

### –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 100 —Å—Ç—Ä–æ–∫

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
processed: 100   (0.1%)
processed: 1000  (1%)
processed: 10000 (10%)
...
processed: 100000 (100%)
```

## üìä –ß—Ç–æ –±—ã–ª–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

### 1. –£–≤–µ–ª–∏—á–µ–Ω–∞ –ø–∞–º—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**docker-compose.yml:**
```yaml
migration-service:
  mem_limit: 512m          # –ë—ã–ª–æ: –±–µ–∑ –ª–∏–º–∏—Ç–∞
  mem_reservation: 256m    # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–º—è—Ç—å
```

### 2. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

–°—Ç—Ä–æ–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–π, –Ω–µ –≤—Å–µ —Å—Ä–∞–∑—É:
```go
for _, row := range rows {
    processRow(row)  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ä–∞–∑—É
}
```

### 3. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```go
if (processed+failed)%100 == 0 {
    updateProgress()  // –ö–∞–∂–¥—ã–µ 100 —Å—Ç—Ä–æ–∫
}
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

–ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞—Å—å - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–∞–ª—å—à–µ:
```go
if err := processRow(row); err != nil {
    failed++
    recordError(err)  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    continue          // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º
}
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–æ –≤—Ä–µ–º—è –∏–º–ø–æ—Ä—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ migration-service
docker-compose logs -f migration-service

# –õ–æ–≥–∏ chat-service
docker-compose logs -f chat-service

# –õ–æ–≥–∏ structure-service
docker-compose logs -f structure-service
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏

```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker stats migration-service

# –í—ã–≤–æ–¥:
# CONTAINER         CPU %   MEM USAGE / LIMIT   MEM %
# migration-service 15.2%   320MiB / 512MiB     62.5%
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫

```bash
# –ü–æ–ª—É—á–∏—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è job
curl http://localhost:8084/migration/jobs/1/errors
```

–û—Ç–≤–µ—Ç:
```json
{
  "errors": [
    {
      "record_identifier": "row_523",
      "error_message": "failed to create chat: duplicate key",
      "created_at": "2024-12-03T10:01:15Z"
    }
  ]
}
```

## ‚ö†Ô∏è –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–°–∏–º–ø—Ç–æ–º:** Request timeout after 30s

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –≤ –∫–ª–∏–µ–Ω—Ç–µ

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–æ 5 –º–∏–Ω—É—Ç
curl -X POST http://localhost:8084/migration/excel \
  --max-time 300 \
  -F "file=@large_file.xlsx"
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Out of memory

**–°–∏–º–ø—Ç–æ–º:** Container killed (OOMKilled)

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏

```yaml
# docker-compose.yml
migration-service:
  mem_limit: 1g  # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 1 –ì–ë
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π

**–°–∏–º–ø—Ç–æ–º:** File size exceeds limit

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ —á–∞—Å—Ç–∏

```bash
# –†–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ 50,000 —Å—Ç—Ä–æ–∫
split -l 50000 large_file.csv part_

# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º
for file in part_*; do
    echo "Importing $file..."
    curl -X POST http://localhost:8084/migration/excel -F "file=@$file"
    sleep 5  # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∏–º–ø–æ—Ä—Ç–∞–º–∏
done
```

## üìà –û—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫?

```bash
# –î–ª—è CSV
wc -l file.csv

# –î–ª—è Excel (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV)
ssconvert file.xlsx file.csv
wc -l file.csv
```

### –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã

| –°—Ç—Ä–æ–∫ | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | –ü–∞–º—è—Ç—å |
|-------|--------------|-----------------|--------|
| 10,000 | 2 –ú–ë | 15 —Å–µ–∫ | 100 –ú–ë |
| 50,000 | 10 –ú–ë | 1 –º–∏–Ω | 200 –ú–ë |
| 100,000 | 20 –ú–ë | 2 –º–∏–Ω | 300 –ú–ë |
| 250,000 | 50 –ú–ë | 5 –º–∏–Ω | 500 –ú–ë |
| 500,000+ | 100+ –ú–ë | ‚ö†Ô∏è –†–∞–∑–±–∏—Ç—å | ‚ö†Ô∏è >1 –ì–ë |

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ñ–∞–π–ª–æ–≤ –¥–æ 50 –ú–ë:
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é  
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å —á–µ—Ä–µ–∑ API  
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—à–∏–±–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –î–ª—è —Ñ–∞–π–ª–æ–≤ 50-100 –ú–ë:
‚ö†Ô∏è –£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å –¥–æ 1 –ì–ë  
‚ö†Ô∏è –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã  
‚ö†Ô∏è –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏

### –î–ª—è —Ñ–∞–π–ª–æ–≤ >100 –ú–ë:
‚ùå –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–±–µ–π—Ç–µ –Ω–∞ —á–∞—Å—Ç–∏  
‚ùå –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ streaming API

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–µ 1000 —Å—Ç—Ä–æ–∫ –¥–ª—è —Ç–µ—Å—Ç–∞
head -n 1001 large_file.csv > test_file.csv

# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
curl -X POST http://localhost:8084/migration/excel \
  -F "file=@test_file.csv"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–∞—Ç—ã
curl http://localhost:8082/chats | jq '.total'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã
curl http://localhost:8083/universities | jq 'length'
```

## ‚úÖ –ò—Ç–æ–≥–æ

**–í–∞—à —Ñ–∞–π–ª 20 –ú–ë:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è –∑–∞ 1.5-2.5 –º–∏–Ω—É—Ç—ã
- ‚úÖ –ü–æ—Ç—Ä–µ–±—É–µ—Ç ~300 –ú–ë –ø–∞–º—è—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç ~100,000 –∑–∞–ø–∏—Å–µ–π –≤ –ë–î
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –º–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–í—Å–µ –≥–æ—Ç–æ–≤–æ –∫ –∏–º–ø–æ—Ä—Ç—É!** üöÄ
