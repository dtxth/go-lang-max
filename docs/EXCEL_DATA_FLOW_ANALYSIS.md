# –ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel –≤ –ë–î

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö Excel

```
–ö–æ–ª–æ–Ω–∫–∞ 0:  –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (79884753064)
–ö–æ–ª–æ–Ω–∫–∞ 1:  max_id (496728250)
–ö–æ–ª–æ–Ω–∫–∞ 2:  –ò–ù–ù_–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (105014177)
–ö–æ–ª–æ–Ω–∫–∞ 3:  –§–û–ò–í_–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (–ú–∏–Ω–æ–±—Ä–Ω–∞—É–∫–∏ –†–æ—Å—Å–∏–∏)
–ö–æ–ª–æ–Ω–∫–∞ 4:  –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏_–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (–§–ï–î–ï–†–ê–õ–¨–ù–û–ï –ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù–û–ï...)
–ö–æ–ª–æ–Ω–∫–∞ 5:  –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è/—Ñ–∏–ª–∏–∞–ª–∞ (–§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ...)
–ö–æ–ª–æ–Ω–∫–∞ 6:  –ò–ù–ù —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ (105014177)
–ö–æ–ª–æ–Ω–∫–∞ 7:  –ö–ü–ü –≥–æ–ª–æ–≤–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è/—Ñ–∏–ª–∏–∞–ª–∞ (10501001)
–ö–æ–ª–æ–Ω–∫–∞ 8:  –§–∞–∫—É–ª—å—Ç–µ—Ç/–∏–Ω—Å—Ç–∏—Ç—É—Ç/–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–ü–æ–ª–∏—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–ª–ª–µ–¥–∂ –ú–ì–¢–£)
–ö–æ–ª–æ–Ω–∫–∞ 9:  –ö—É—Ä—Å –æ–±—É—á–µ–Ω–∏—è (2)
–ö–æ–ª–æ–Ω–∫–∞ 10: –ù–æ–º–µ—Ä –≥—Ä—É–ø–ø—ã (–ö–æ–ª–ª–µ–¥–∂ –ò–ü-22 (2024)
–ö–æ–ª–æ–Ω–∫–∞ 11: –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ (–ö–æ–ª–ª–µ–¥–∂ –ò–ü-22 (2024 –û–§–û –ú–ì–¢–£)
–ö–æ–ª–æ–Ω–∫–∞ 12: –ú–æ–±–∏–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–∞—Ç–∞ (79884753064)
–ö–æ–ª–æ–Ω–∫–∞ 13: –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ (–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –Ω–∞—É–∫–∏ –∏ –≤—ã—Å—à–µ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è...)
–ö–æ–ª–æ–Ω–∫–∞ 14: chat_id (-69257108032233)
–ö–æ–ª–æ–Ω–∫–∞ 15: link (https://max.ru/join/fqQlVkO6LU-RAw5HkshlQy6giI9kJiFU_a0OoJ75TTQ)
–ö–æ–ª–æ–Ω–∫–∞ 16: add_user (–ò–°–¢–ò–ù–ê)
–ö–æ–ª–æ–Ω–∫–∞ 17: add_admin (–ò–°–¢–ò–ù–ê)
```

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ù–ï –≥–æ—Ç–æ–≤–∞!

### –ß—Ç–æ –Ω–µ —Ç–∞–∫:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫** - —Ç–µ–∫—É—â–∏–π –∫–æ–¥ –æ–∂–∏–¥–∞–µ—Ç –¥—Ä—É–≥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–ª—è –≤ –ë–î** - `chat_id`, `add_user`, `add_admin`
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç max_id –∏ —Ñ–ª–∞–≥–∏

## ‚úÖ –ö—É–¥–∞ –ø–æ–ø–∞–¥—É—Ç –¥–∞–Ω–Ω—ã–µ

### 1. Structure Service ‚Üí PostgreSQL (structure_db)

**–¢–∞–±–ª–∏—Ü–∞: `universities`**
```sql
INSERT INTO universities (name, inn, kpp, foiv)
VALUES (
  '–§–ï–î–ï–†–ê–õ–¨–ù–û–ï –ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù–û–ï –ë–Æ–î–ñ–ï–¢–ù–û–ï –û–ë–†–ê–ó–û–í–ê–¢–ï–õ–¨–ù–û–ï –£–ß–†–ï–ñ–î–ï–ù–ò–ï...',  -- –ö–æ–ª–æ–Ω–∫–∞ 4
  '105014177',                                                              -- –ö–æ–ª–æ–Ω–∫–∞ 6
  '10501001',                                                               -- –ö–æ–ª–æ–Ω–∫–∞ 7
  '–ú–∏–Ω–æ–±—Ä–Ω–∞—É–∫–∏ –†–æ—Å—Å–∏–∏'                                                      -- –ö–æ–ª–æ–Ω–∫–∞ 3
);
```

**–¢–∞–±–ª–∏—Ü–∞: `branches`**
```sql
INSERT INTO branches (university_id, name)
VALUES (
  1,  -- ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞
  '–§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –±—é–¥–∂–µ—Ç–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ...'  -- –ö–æ–ª–æ–Ω–∫–∞ 5
);
```

**–¢–∞–±–ª–∏—Ü–∞: `faculties`**
```sql
INSERT INTO faculties (branch_id, name)
VALUES (
  1,  -- ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞
  '–ü–æ–ª–∏—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–ª–ª–µ–¥–∂ –ú–ì–¢–£'  -- –ö–æ–ª–æ–Ω–∫–∞ 8
);
```

**–¢–∞–±–ª–∏—Ü–∞: `groups`**
```sql
INSERT INTO groups (faculty_id, course, number, chat_id)
VALUES (
  1,                           -- ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞
  2,                           -- –ö–æ–ª–æ–Ω–∫–∞ 9
  '–ö–æ–ª–ª–µ–¥–∂ –ò–ü-22 (2024',       -- –ö–æ–ª–æ–Ω–∫–∞ 10
  NULL                         -- –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞
);
```

### 2. Chat Service ‚Üí PostgreSQL (chat_db)

**–¢–∞–±–ª–∏—Ü–∞: `chats`**
```sql
INSERT INTO chats (name, url, max_chat_id, university_id, source)
VALUES (
  '–ö–æ–ª–ª–µ–¥–∂ –ò–ü-22 (2024 –û–§–û –ú–ì–¢–£',                                          -- –ö–æ–ª–æ–Ω–∫–∞ 11
  'https://max.ru/join/fqQlVkO6LU-RAw5HkshlQy6giI9kJiFU_a0OoJ75TTQ',      -- –ö–æ–ª–æ–Ω–∫–∞ 15
  '-69257108032233',                                                        -- –ö–æ–ª–æ–Ω–∫–∞ 14 ‚ö†Ô∏è –ù–£–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨
  1,                                                                        -- ID —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞
  'academic_group'                                                          -- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞
);
```

**–¢–∞–±–ª–∏—Ü–∞: `administrators`**
```sql
INSERT INTO administrators (chat_id, phone, max_id)
VALUES (
  1,                    -- ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —á–∞—Ç–∞
  '+79884753064',       -- –ö–æ–ª–æ–Ω–∫–∞ 0 –∏–ª–∏ 12 (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π)
  '496728250'           -- –ö–æ–ª–æ–Ω–∫–∞ 1
);
```

### 3. Migration Service ‚Üí PostgreSQL (migration_db)

**–¢–∞–±–ª–∏—Ü–∞: `migration_jobs`**
```sql
INSERT INTO migration_jobs (source_type, source_identifier, status, total, processed, failed)
VALUES (
  'excel',
  '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —á–∞—Ç–æ–≤ –≥—Ä—É–ø–ø –ú–ì–¢–£ –≤ –ú–ê–• 17.11.25_–ò–¢–û–ì.xlsx',
  'running',
  1,
  0,
  0
);
```

**–¢–∞–±–ª–∏—Ü–∞: `migration_errors`** (–µ—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏)
```sql
INSERT INTO migration_errors (job_id, record_identifier, error_message)
VALUES (
  1,
  'row_2',
  'Failed to create chat: ...'
);
```

## üîß –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î chat-service

```sql
-- chat-service/migrations/002_add_missing_fields.sql
ALTER TABLE chats ADD COLUMN IF NOT EXISTS external_chat_id TEXT;
CREATE INDEX IF NOT EXISTS idx_chats_external_chat_id ON chats(external_chat_id);

ALTER TABLE administrators ADD COLUMN IF NOT EXISTS add_user BOOLEAN DEFAULT TRUE;
ALTER TABLE administrators ADD COLUMN IF NOT EXISTS add_admin BOOLEAN DEFAULT TRUE;
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å Go —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**chat-service/internal/domain/chat.go:**
```go
type Chat struct {
    ID             int64       `json:"id"`
    Name           string      `json:"name"`
    URL            string      `json:"url"`
    MaxChatID      string      `json:"max_chat_id"`
    ExternalChatID *string     `json:"external_chat_id,omitempty"` // ‚¨ÖÔ∏è –ù–û–í–û–ï (–ö–æ–ª–æ–Ω–∫–∞ 14)
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

**chat-service/internal/domain/administrator.go:**
```go
type Administrator struct {
    ID       int64   `json:"id"`
    ChatID   int64   `json:"chat_id"`
    Phone    string  `json:"phone"`
    MaxID    string  `json:"max_id"`
    AddUser  bool    `json:"add_user"`   // ‚¨ÖÔ∏è –ù–û–í–û–ï (–ö–æ–ª–æ–Ω–∫–∞ 16)
    AddAdmin bool    `json:"add_admin"`  // ‚¨ÖÔ∏è –ù–û–í–û–ï (–ö–æ–ª–æ–Ω–∫–∞ 17)
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å ExcelRow —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**migration-service/internal/usecase/migrate_from_excel.go:**
```go
type ExcelRow struct {
    RowNumber        int
    AdminPhone1      string // –ö–æ–ª–æ–Ω–∫–∞ 0 - –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    MaxID            string // –ö–æ–ª–æ–Ω–∫–∞ 1 - max_id
    INNReference     string // –ö–æ–ª–æ–Ω–∫–∞ 2 - –ò–ù–ù_–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫
    FOIVReference    string // –ö–æ–ª–æ–Ω–∫–∞ 3 - –§–û–ò–í_–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫
    OrgNameRef       string // –ö–æ–ª–æ–Ω–∫–∞ 4 - –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏_–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫
    BranchName       string // –ö–æ–ª–æ–Ω–∫–∞ 5 - –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    INN              string // –ö–æ–ª–æ–Ω–∫–∞ 6 - –ò–ù–ù —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞
    KPP              string // –ö–æ–ª–æ–Ω–∫–∞ 7 - –ö–ü–ü
    FacultyName      string // –ö–æ–ª–æ–Ω–∫–∞ 8 - –§–∞–∫—É–ª—å—Ç–µ—Ç/–∏–Ω—Å—Ç–∏—Ç—É—Ç
    Course           int    // –ö–æ–ª–æ–Ω–∫–∞ 9 - –ö—É—Ä—Å –æ–±—É—á–µ–Ω–∏—è
    GroupNumber      string // –ö–æ–ª–æ–Ω–∫–∞ 10 - –ù–æ–º–µ—Ä –≥—Ä—É–ø–ø—ã
    ChatName         string // –ö–æ–ª–æ–Ω–∫–∞ 11 - –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞
    AdminPhone2      string // –ö–æ–ª–æ–Ω–∫–∞ 12 - –ú–æ–±–∏–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    FileName         string // –ö–æ–ª–æ–Ω–∫–∞ 13 - –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    ChatID           string // –ö–æ–ª–æ–Ω–∫–∞ 14 - chat_id
    ChatURL          string // –ö–æ–ª–æ–Ω–∫–∞ 15 - link
    AddUser          string // –ö–æ–ª–æ–Ω–∫–∞ 16 - add_user
    AddAdmin         string // –ö–æ–ª–æ–Ω–∫–∞ 17 - add_admin
}
```

### 4. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é readFromExcel

```go
func (uc *MigrateFromExcelUseCase) readFromExcel(filePath string) ([]ExcelRow, error) {
    f, err := excelize.OpenFile(filePath)
    if err != nil {
        return nil, fmt.Errorf("failed to open Excel file: %w", err)
    }
    defer f.Close()

    sheets := f.GetSheetList()
    if len(sheets) == 0 {
        return nil, fmt.Errorf("no sheets found in Excel file")
    }

    sheetName := sheets[0]
    rows, err := f.GetRows(sheetName)
    if err != nil {
        return nil, fmt.Errorf("failed to get rows: %w", err)
    }

    if len(rows) < 2 {
        return nil, fmt.Errorf("Excel file must have at least a header row and one data row")
    }

    var excelRows []ExcelRow
    ctx := context.Background()
    
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (—Å—Ç—Ä–æ–∫–∞ 0)
    for i := 1; i < len(rows); i++ {
        row := rows[i]
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫
        if len(row) < 18 {
            uc.logger.Warn(ctx, "Skipping row: insufficient columns", map[string]interface{}{
                "row_number": i + 1,
                "columns":    len(row),
            })
            continue
        }

        // –ü–∞—Ä—Å–∏–º –∫—É—Ä—Å
        course := 0
        if row[9] != "" {
            course, _ = strconv.Atoi(row[9])
        }

        excelRow := ExcelRow{
            RowNumber:     i + 1,
            AdminPhone1:   row[0],
            MaxID:         row[1],
            INNReference:  row[2],
            FOIVReference: row[3],
            OrgNameRef:    row[4],
            BranchName:    row[5],
            INN:           row[6],
            KPP:           row[7],
            FacultyName:   row[8],
            Course:        course,
            GroupNumber:   row[10],
            ChatName:      row[11],
            AdminPhone2:   row[12],
            FileName:      row[13],
            ChatID:        row[14],
            ChatURL:       row[15],
            AddUser:       row[16],
            AddAdmin:      row[17],
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
        if excelRow.INN == "" || excelRow.ChatURL == "" {
            uc.logger.Warn(ctx, "Skipping row: missing required fields", map[string]interface{}{
                "row_number": excelRow.RowNumber,
            })
            continue
        }

        excelRows = append(excelRows, excelRow)
    }

    return excelRows, nil
}
```

### 5. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é processRow

```go
func (uc *MigrateFromExcelUseCase) processRow(ctx context.Context, jobID int, row *ExcelRow) error {
    // 1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —á–µ—Ä–µ–∑ Structure Service
    structureData := &domain.StructureData{
        INN:         row.INN,
        KPP:         row.KPP,
        FOIV:        row.FOIVReference,
        OrgName:     row.OrgNameRef,
        BranchName:  row.BranchName,
        FacultyName: row.FacultyName,
        Course:      row.Course,
        GroupNumber: row.GroupNumber,
        ChatName:    row.ChatName,
        ChatURL:     row.ChatURL,
    }

    structureResult, err := uc.structureService.CreateStructure(ctx, structureData)
    if err != nil {
        return fmt.Errorf("failed to create structure: %w", err)
    }

    // 2. –°–æ–∑–¥–∞—Ç—å —á–∞—Ç —á–µ—Ä–µ–∑ Chat Service
    chatData := &domain.ChatData{
        Name:           row.ChatName,
        URL:            row.ChatURL,
        ExternalChatID: row.ChatID,           // ‚¨ÖÔ∏è –ù–û–í–û–ï
        UniversityID:   structureResult.UniversityID,
        Source:         "academic_group",
    }

    chatID, err := uc.chatService.CreateChat(ctx, chatData)
    if err != nil {
        return fmt.Errorf("failed to create chat: %w", err)
    }

    // 3. –°–≤—è–∑–∞—Ç—å –≥—Ä—É–ø–ø—É —Å —á–∞—Ç–æ–º
    if err := uc.structureService.LinkGroupToChat(ctx, structureResult.GroupID, chatID); err != nil {
        uc.logger.Warn(ctx, "Failed to link group to chat", map[string]interface{}{
            "group_id": structureResult.GroupID,
            "chat_id":  chatID,
            "error":    err.Error(),
        })
    }

    // 4. –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–µ—Å–ª–∏ add_admin = –ò–°–¢–ò–ù–ê)
    addAdmin := strings.ToUpper(row.AddAdmin) == "–ò–°–¢–ò–ù–ê" || 
                strings.ToUpper(row.AddAdmin) == "TRUE"
    addUser := strings.ToUpper(row.AddUser) == "–ò–°–¢–ò–ù–ê" || 
               strings.ToUpper(row.AddUser) == "TRUE"

    if addAdmin {
        // –í—ã–±–∏—Ä–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç AdminPhone1)
        phone := row.AdminPhone1
        if phone == "" {
            phone = row.AdminPhone2
        }
        
        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
        phone = normalizePhone(phone)
        
        adminData := &domain.AdministratorData{
            ChatID:   chatID,
            Phone:    phone,
            MaxID:    row.MaxID,
            AddUser:  addUser,   // ‚¨ÖÔ∏è –ù–û–í–û–ï
            AddAdmin: addAdmin,  // ‚¨ÖÔ∏è –ù–û–í–û–ï
        }

        if err := uc.chatService.AddAdministrator(ctx, adminData); err != nil {
            uc.logger.Warn(ctx, "Failed to add administrator", map[string]interface{}{
                "chat_id": chatID,
                "phone":   phone,
                "error":   err.Error(),
            })
        }
    }

    return nil
}

// normalizePhone –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
func normalizePhone(phone string) string {
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
    digits := ""
    for _, r := range phone {
        if r >= '0' && r <= '9' {
            digits += string(r)
        }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º + –µ—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7
    if len(digits) == 11 && digits[0] == '7' {
        return "+" + digits
    }
    
    return digits
}
```

## üìã –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
Excel File (18 –∫–æ–ª–æ–Ω–æ–∫)
    ‚Üì
Migration Service (POST /migration/excel)
    ‚Üì
    ‚îú‚îÄ‚Üí Structure Service (gRPC)
    ‚îÇ   ‚îú‚îÄ‚Üí universities (INN, KPP, FOIV, Name)
    ‚îÇ   ‚îú‚îÄ‚Üí branches (Name)
    ‚îÇ   ‚îú‚îÄ‚Üí faculties (Name)
    ‚îÇ   ‚îî‚îÄ‚Üí groups (Course, Number)
    ‚îÇ
    ‚îî‚îÄ‚Üí Chat Service (gRPC)
        ‚îú‚îÄ‚Üí chats (Name, URL, ExternalChatID, UniversityID, Source)
        ‚îî‚îÄ‚Üí administrators (Phone, MaxID, AddUser, AddAdmin)
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞

### Structure Service DB (structure_db):
- ‚úÖ 1 –∑–∞–ø–∏—Å—å –≤ `universities`
- ‚úÖ 1 –∑–∞–ø–∏—Å—å –≤ `branches`
- ‚úÖ 1 –∑–∞–ø–∏—Å—å –≤ `faculties`
- ‚úÖ 1 –∑–∞–ø–∏—Å—å –≤ `groups`

### Chat Service DB (chat_db):
- ‚úÖ 1 –∑–∞–ø–∏—Å—å –≤ `chats` (—Å external_chat_id)
- ‚úÖ 1 –∑–∞–ø–∏—Å—å –≤ `administrators` (—Å max_id, add_user, add_admin)

### Migration Service DB (migration_db):
- ‚úÖ 1 –∑–∞–ø–∏—Å—å –≤ `migration_jobs` (—Å—Ç–∞—Ç—É—Å, –ø—Ä–æ–≥—Ä–µ—Å—Å)
- ‚ö†Ô∏è N –∑–∞–ø–∏—Å–µ–π –≤ `migration_errors` (–µ—Å–ª–∏ –±—ã–ª–∏ –æ—à–∏–±–∫–∏)

## ‚è±Ô∏è –í—Ä–µ–º—è –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É: ~45 –º–∏–Ω—É—Ç

1. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î** (10 –º–∏–Ω) - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è
2. **Go —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** (15 –º–∏–Ω) - –æ–±–Ω–æ–≤–∏—Ç—å domain –º–æ–¥–µ–ª–∏
3. **Excel –æ–±—Ä–∞–±–æ—Ç–∫–∞** (15 –º–∏–Ω) - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (5 –º–∏–Ω) - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 70%

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç ‚Üí —Ñ–∏–ª–∏–∞–ª ‚Üí —Ñ–∞–∫—É–ª—å—Ç–µ—Ç ‚Üí –≥—Ä—É–ø–ø–∞)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–æ–≤ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—É
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- üîß –ü–æ–ª–µ `external_chat_id` –≤ —á–∞—Ç–∞—Ö (–ö–æ–ª–æ–Ω–∫–∞ 14)
- üîß –ü–æ–ª—è `add_user`, `add_admin` –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞—Ö (–ö–æ–ª–æ–Ω–∫–∏ 16-17)
- üîß –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ 18 –∫–æ–ª–æ–Ω–æ–∫ Excel
- üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ max_id –∏–∑ Excel (–ö–æ–ª–æ–Ω–∫–∞ 1)
