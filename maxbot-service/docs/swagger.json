{
    "swagger": "2.0",
    "info": {
        "contact": {}
    },
    "paths": {
        "/me": {
            "get": {
                "description": "Get bot name and add bot link",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Bot"
                ],
                "summary": "Get bot information",
                "responses": {
                    "200": {
                        "description": "Bot information",
                        "schema": {
                            "$ref": "#/definitions/BotInfoResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            }
        },
        "/monitoring/profiles/coverage": {
            "get": {
                "description": "Get metrics about profile data coverage",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Monitoring"
                ],
                "summary": "Get profile coverage metrics",
                "responses": {
                    "200": {
                        "description": "Profile coverage metrics",
                        "schema": {
                            "$ref": "#/definitions/ProfileCoverageResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            }
        },
        "/monitoring/profiles/quality": {
            "get": {
                "description": "Get detailed report about profile data quality",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Monitoring"
                ],
                "summary": "Get profile quality report",
                "responses": {
                    "200": {
                        "description": "Profile quality report",
                        "schema": {
                            "$ref": "#/definitions/ProfileQualityReportResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            }
        },
        "/monitoring/webhook/stats": {
            "get": {
                "description": "Get statistics about webhook event processing",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Monitoring"
                ],
                "summary": "Get webhook processing statistics",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Time period (hour, day, week, month)",
                        "name": "period",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Webhook statistics",
                        "schema": {
                            "$ref": "#/definitions/WebhookStatsResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid period parameter",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            }
        },
        "/profiles/stats": {
            "get": {
                "description": "Get statistics about user profiles",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Profile"
                ],
                "summary": "Get profile statistics",
                "responses": {
                    "200": {
                        "description": "Profile statistics",
                        "schema": {
                            "$ref": "#/definitions/ProfileStatsResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            }
        },
        "/profiles/{user_id}": {
            "get": {
                "description": "Get user profile information by user ID",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Profile"
                ],
                "summary": "Get user profile",
                "parameters": [
                    {
                        "type": "string",
                        "description": "User ID",
                        "name": "user_id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "User profile",
                        "schema": {
                            "$ref": "#/definitions/ProfileResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid user ID",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Profile not found",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            },
            "put": {
                "description": "Update user profile information",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Profile"
                ],
                "summary": "Update user profile",
                "parameters": [
                    {
                        "type": "string",
                        "description": "User ID",
                        "name": "user_id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Profile updates",
                        "name": "profile",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/ProfileUpdateRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Updated profile",
                        "schema": {
                            "$ref": "#/definitions/ProfileResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            }
        },
        "/profiles/{user_id}/name": {
            "post": {
                "description": "Set name provided by user",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Profile"
                ],
                "summary": "Set user-provided name",
                "parameters": [
                    {
                        "type": "string",
                        "description": "User ID",
                        "name": "user_id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "User-provided name",
                        "name": "name",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/SetNameRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Updated profile",
                        "schema": {
                            "$ref": "#/definitions/ProfileResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            }
        },
        "/webhook/max": {
            "post": {
                "description": "Process incoming webhook events from MAX Messenger",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Webhook"
                ],
                "summary": "Handle MAX webhook events",
                "parameters": [
                    {
                        "description": "Webhook event",
                        "name": "event",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/domain.MaxWebhookEvent"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Event processed successfully",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/ErrorResponse"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "BotInfoResponse": {
            "description": "Bot information response",
            "type": "object",
            "properties": {
                "add_link": {
                    "description": "Link to add the bot",
                    "type": "string",
                    "example": "https://max.ru/add-bot"
                },
                "name": {
                    "description": "Bot name",
                    "type": "string",
                    "example": "MAX Bot"
                }
            }
        },
        "ErrorResponse": {
            "description": "Error response structure",
            "type": "object",
            "properties": {
                "error": {
                    "description": "Error code",
                    "type": "string",
                    "example": "internal_error"
                },
                "message": {
                    "description": "Error message",
                    "type": "string",
                    "example": "Internal server error"
                }
            }
        },
        "ProfileCoverageResponse": {
            "description": "Profile coverage metrics response",
            "type": "object",
            "properties": {
                "coverage_percentage": {
                    "description": "Coverage percentage",
                    "type": "number",
                    "example": 80
                },
                "full_name_percentage": {
                    "description": "Full name percentage",
                    "type": "number",
                    "example": 60
                },
                "last_updated": {
                    "description": "Last update time",
                    "type": "string",
                    "example": "2024-01-15T10:30:00Z"
                },
                "profiles_by_source": {
                    "description": "Profiles by source",
                    "type": "object",
                    "additionalProperties": {
                        "type": "integer",
                        "format": "int64"
                    }
                },
                "total_users": {
                    "description": "Total users",
                    "type": "integer",
                    "example": 10000
                },
                "users_with_full_names": {
                    "description": "Users with full names",
                    "type": "integer",
                    "example": 6000
                },
                "users_with_profiles": {
                    "description": "Users with profiles",
                    "type": "integer",
                    "example": 8000
                }
            }
        },
        "ProfileDataIssueResponse": {
            "description": "Profile data issue",
            "type": "object",
            "properties": {
                "count": {
                    "description": "Affected profiles count",
                    "type": "integer",
                    "example": 2000
                },
                "description": {
                    "description": "Issue description",
                    "type": "string",
                    "example": "Missing full names"
                },
                "severity": {
                    "description": "Issue severity",
                    "type": "string",
                    "example": "medium"
                },
                "type": {
                    "description": "Issue type",
                    "type": "string",
                    "example": "incomplete_profiles"
                }
            }
        },
        "ProfileQualityMetricsResponse": {
            "description": "Profile quality metrics",
            "type": "object",
            "properties": {
                "complete_profiles": {
                    "description": "Complete profiles",
                    "type": "integer",
                    "example": 7000
                },
                "completeness_score": {
                    "description": "Completeness score",
                    "type": "number",
                    "example": 70
                },
                "empty_profiles": {
                    "description": "Empty profiles",
                    "type": "integer",
                    "example": 1000
                },
                "freshness_score": {
                    "description": "Freshness score",
                    "type": "number",
                    "example": 90
                },
                "partial_profiles": {
                    "description": "Partial profiles",
                    "type": "integer",
                    "example": 2000
                },
                "quality_score": {
                    "description": "Quality score (0-100)",
                    "type": "number",
                    "example": 85.5
                },
                "stale_profiles": {
                    "description": "Stale profiles",
                    "type": "integer",
                    "example": 500
                }
            }
        },
        "ProfileQualityReportResponse": {
            "description": "Profile quality report response",
            "type": "object",
            "properties": {
                "data_issues": {
                    "description": "Data issues",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/ProfileDataIssueResponse"
                    }
                },
                "generated_at": {
                    "description": "Report generation time",
                    "type": "string",
                    "example": "2024-01-15T10:30:00Z"
                },
                "quality_metrics": {
                    "description": "Quality metrics",
                    "allOf": [
                        {
                            "$ref": "#/definitions/ProfileQualityMetricsResponse"
                        }
                    ]
                },
                "recommended_actions": {
                    "description": "Recommended actions",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "source_breakdown": {
                    "description": "Quality by source",
                    "type": "object",
                    "additionalProperties": {
                        "$ref": "#/definitions/SourceQualityResponse"
                    }
                },
                "total_profiles": {
                    "description": "Total profiles",
                    "type": "integer",
                    "example": 10000
                }
            }
        },
        "ProfileResponse": {
            "description": "User profile information",
            "type": "object",
            "properties": {
                "display_name": {
                    "description": "Display name (prioritized)",
                    "type": "string",
                    "example": "Иван Петрович"
                },
                "has_full_name": {
                    "description": "Whether profile has full name",
                    "type": "boolean",
                    "example": true
                },
                "last_updated": {
                    "description": "Last update time",
                    "type": "string",
                    "example": "2024-01-15T10:30:00Z"
                },
                "max_first_name": {
                    "description": "First name from MAX",
                    "type": "string",
                    "example": "Иван"
                },
                "max_last_name": {
                    "description": "Last name from MAX",
                    "type": "string",
                    "example": "Петров"
                },
                "source": {
                    "description": "Profile source",
                    "type": "string",
                    "example": "user_input"
                },
                "user_id": {
                    "description": "User ID",
                    "type": "string",
                    "example": "12345"
                },
                "user_provided_name": {
                    "description": "User-provided name",
                    "type": "string",
                    "example": "Иван Петрович"
                }
            }
        },
        "ProfileStatsResponse": {
            "description": "Profile statistics response",
            "type": "object",
            "properties": {
                "profiles_by_source": {
                    "description": "Profiles by source",
                    "type": "object",
                    "additionalProperties": {
                        "type": "integer",
                        "format": "int64"
                    }
                },
                "profiles_with_full_name": {
                    "description": "Profiles with full names",
                    "type": "integer",
                    "example": 750
                },
                "total_profiles": {
                    "description": "Total number of profiles",
                    "type": "integer",
                    "example": 1000
                }
            }
        },
        "ProfileUpdateRequest": {
            "description": "Profile update request",
            "type": "object",
            "properties": {
                "max_first_name": {
                    "description": "First name from MAX",
                    "type": "string",
                    "example": "Иван"
                },
                "max_last_name": {
                    "description": "Last name from MAX",
                    "type": "string",
                    "example": "Петров"
                },
                "user_provided_name": {
                    "description": "User-provided name",
                    "type": "string",
                    "example": "Иван П."
                }
            }
        },
        "SetNameRequest": {
            "description": "Set user-provided name request",
            "type": "object",
            "required": [
                "name"
            ],
            "properties": {
                "name": {
                    "description": "User-provided name",
                    "type": "string",
                    "example": "Иван Петрович"
                }
            }
        },
        "SourceQualityResponse": {
            "description": "Quality metrics by source",
            "type": "object",
            "properties": {
                "average_age_days": {
                    "description": "Average age in days",
                    "type": "number",
                    "example": 7.5
                },
                "complete_profiles": {
                    "description": "Complete profiles",
                    "type": "integer",
                    "example": 4000
                },
                "count": {
                    "description": "Count of profiles",
                    "type": "integer",
                    "example": 5000
                },
                "quality_score": {
                    "description": "Quality score",
                    "type": "number",
                    "example": 85
                }
            }
        },
        "TimePeriodResponse": {
            "description": "Time period for statistics",
            "type": "object",
            "properties": {
                "from": {
                    "description": "Start time",
                    "type": "string",
                    "example": "2024-01-15T00:00:00Z"
                },
                "to": {
                    "description": "End time",
                    "type": "string",
                    "example": "2024-01-16T00:00:00Z"
                }
            }
        },
        "WebhookStatsResponse": {
            "description": "Webhook processing statistics response",
            "type": "object",
            "properties": {
                "average_processing_time_ms": {
                    "description": "Average processing time",
                    "type": "number",
                    "example": 150.5
                },
                "errors_by_type": {
                    "description": "Errors by type",
                    "type": "object",
                    "additionalProperties": {
                        "type": "integer",
                        "format": "int64"
                    }
                },
                "events_by_type": {
                    "description": "Events by type",
                    "type": "object",
                    "additionalProperties": {
                        "type": "integer",
                        "format": "int64"
                    }
                },
                "failed_events": {
                    "description": "Failed events",
                    "type": "integer",
                    "example": 200
                },
                "period": {
                    "description": "Time period",
                    "allOf": [
                        {
                            "$ref": "#/definitions/TimePeriodResponse"
                        }
                    ]
                },
                "profiles_extracted": {
                    "description": "Profiles extracted from events",
                    "type": "integer",
                    "example": 3000
                },
                "profiles_stored": {
                    "description": "Profiles stored in cache",
                    "type": "integer",
                    "example": 2900
                },
                "successful_events": {
                    "description": "Successful events",
                    "type": "integer",
                    "example": 4800
                },
                "total_events": {
                    "description": "Total webhook events",
                    "type": "integer",
                    "example": 5000
                }
            }
        },
        "domain.CallbackEvent": {
            "type": "object",
            "properties": {
                "chat": {
                    "$ref": "#/definitions/domain.WebhookChatInfo"
                },
                "data": {
                    "type": "string"
                },
                "user": {
                    "$ref": "#/definitions/domain.UserInfo"
                }
            }
        },
        "domain.MaxWebhookEvent": {
            "type": "object",
            "properties": {
                "callback_query": {
                    "$ref": "#/definitions/domain.CallbackEvent"
                },
                "message": {
                    "$ref": "#/definitions/domain.MessageEvent"
                },
                "type": {
                    "type": "string"
                }
            }
        },
        "domain.MessageEvent": {
            "type": "object",
            "properties": {
                "chat": {
                    "$ref": "#/definitions/domain.WebhookChatInfo"
                },
                "from": {
                    "$ref": "#/definitions/domain.UserInfo"
                },
                "text": {
                    "type": "string"
                }
            }
        },
        "domain.UserInfo": {
            "type": "object",
            "properties": {
                "first_name": {
                    "type": "string"
                },
                "last_name": {
                    "type": "string"
                },
                "user_id": {
                    "type": "string"
                }
            }
        },
        "domain.WebhookChatInfo": {
            "type": "object",
            "properties": {
                "chat_id": {
                    "type": "integer"
                },
                "type": {
                    "type": "string"
                }
            }
        }
    }
}