definitions:
  BotInfoResponse:
    description: Bot information response
    properties:
      add_link:
        description: Link to add the bot
        example: https://max.ru/add-bot
        type: string
      name:
        description: Bot name
        example: MAX Bot
        type: string
    type: object
  ErrorResponse:
    description: Error response structure
    properties:
      error:
        description: Error code
        example: internal_error
        type: string
      message:
        description: Error message
        example: Internal server error
        type: string
    type: object
  ProfileCoverageResponse:
    description: Profile coverage metrics response
    properties:
      coverage_percentage:
        description: Coverage percentage
        example: 80
        type: number
      full_name_percentage:
        description: Full name percentage
        example: 60
        type: number
      last_updated:
        description: Last update time
        example: "2024-01-15T10:30:00Z"
        type: string
      profiles_by_source:
        additionalProperties:
          format: int64
          type: integer
        description: Profiles by source
        type: object
      total_users:
        description: Total users
        example: 10000
        type: integer
      users_with_full_names:
        description: Users with full names
        example: 6000
        type: integer
      users_with_profiles:
        description: Users with profiles
        example: 8000
        type: integer
    type: object
  ProfileDataIssueResponse:
    description: Profile data issue
    properties:
      count:
        description: Affected profiles count
        example: 2000
        type: integer
      description:
        description: Issue description
        example: Missing full names
        type: string
      severity:
        description: Issue severity
        example: medium
        type: string
      type:
        description: Issue type
        example: incomplete_profiles
        type: string
    type: object
  ProfileQualityMetricsResponse:
    description: Profile quality metrics
    properties:
      complete_profiles:
        description: Complete profiles
        example: 7000
        type: integer
      completeness_score:
        description: Completeness score
        example: 70
        type: number
      empty_profiles:
        description: Empty profiles
        example: 1000
        type: integer
      freshness_score:
        description: Freshness score
        example: 90
        type: number
      partial_profiles:
        description: Partial profiles
        example: 2000
        type: integer
      quality_score:
        description: Quality score (0-100)
        example: 85.5
        type: number
      stale_profiles:
        description: Stale profiles
        example: 500
        type: integer
    type: object
  ProfileQualityReportResponse:
    description: Profile quality report response
    properties:
      data_issues:
        description: Data issues
        items:
          $ref: '#/definitions/ProfileDataIssueResponse'
        type: array
      generated_at:
        description: Report generation time
        example: "2024-01-15T10:30:00Z"
        type: string
      quality_metrics:
        allOf:
        - $ref: '#/definitions/ProfileQualityMetricsResponse'
        description: Quality metrics
      recommended_actions:
        description: Recommended actions
        items:
          type: string
        type: array
      source_breakdown:
        additionalProperties:
          $ref: '#/definitions/SourceQualityResponse'
        description: Quality by source
        type: object
      total_profiles:
        description: Total profiles
        example: 10000
        type: integer
    type: object
  ProfileResponse:
    description: User profile information
    properties:
      display_name:
        description: Display name (prioritized)
        example: Иван Петрович
        type: string
      has_full_name:
        description: Whether profile has full name
        example: true
        type: boolean
      last_updated:
        description: Last update time
        example: "2024-01-15T10:30:00Z"
        type: string
      max_first_name:
        description: First name from MAX
        example: Иван
        type: string
      max_last_name:
        description: Last name from MAX
        example: Петров
        type: string
      source:
        description: Profile source
        example: user_input
        type: string
      user_id:
        description: User ID
        example: "12345"
        type: string
      user_provided_name:
        description: User-provided name
        example: Иван Петрович
        type: string
    type: object
  ProfileStatsResponse:
    description: Profile statistics response
    properties:
      profiles_by_source:
        additionalProperties:
          format: int64
          type: integer
        description: Profiles by source
        type: object
      profiles_with_full_name:
        description: Profiles with full names
        example: 750
        type: integer
      total_profiles:
        description: Total number of profiles
        example: 1000
        type: integer
    type: object
  ProfileUpdateRequest:
    description: Profile update request
    properties:
      max_first_name:
        description: First name from MAX
        example: Иван
        type: string
      max_last_name:
        description: Last name from MAX
        example: Петров
        type: string
      user_provided_name:
        description: User-provided name
        example: Иван П.
        type: string
    type: object
  SetNameRequest:
    description: Set user-provided name request
    properties:
      name:
        description: User-provided name
        example: Иван Петрович
        type: string
    required:
    - name
    type: object
  SourceQualityResponse:
    description: Quality metrics by source
    properties:
      average_age_days:
        description: Average age in days
        example: 7.5
        type: number
      complete_profiles:
        description: Complete profiles
        example: 4000
        type: integer
      count:
        description: Count of profiles
        example: 5000
        type: integer
      quality_score:
        description: Quality score
        example: 85
        type: number
    type: object
  TimePeriodResponse:
    description: Time period for statistics
    properties:
      from:
        description: Start time
        example: "2024-01-15T00:00:00Z"
        type: string
      to:
        description: End time
        example: "2024-01-16T00:00:00Z"
        type: string
    type: object
  WebhookStatsResponse:
    description: Webhook processing statistics response
    properties:
      average_processing_time_ms:
        description: Average processing time
        example: 150.5
        type: number
      errors_by_type:
        additionalProperties:
          format: int64
          type: integer
        description: Errors by type
        type: object
      events_by_type:
        additionalProperties:
          format: int64
          type: integer
        description: Events by type
        type: object
      failed_events:
        description: Failed events
        example: 200
        type: integer
      period:
        allOf:
        - $ref: '#/definitions/TimePeriodResponse'
        description: Time period
      profiles_extracted:
        description: Profiles extracted from events
        example: 3000
        type: integer
      profiles_stored:
        description: Profiles stored in cache
        example: 2900
        type: integer
      successful_events:
        description: Successful events
        example: 4800
        type: integer
      total_events:
        description: Total webhook events
        example: 5000
        type: integer
    type: object
  domain.CallbackEvent:
    properties:
      chat:
        $ref: '#/definitions/domain.WebhookChatInfo'
      data:
        type: string
      user:
        $ref: '#/definitions/domain.UserInfo'
    type: object
  domain.MaxWebhookEvent:
    properties:
      callback_query:
        $ref: '#/definitions/domain.CallbackEvent'
      message:
        $ref: '#/definitions/domain.MessageEvent'
      type:
        type: string
    type: object
  domain.MessageEvent:
    properties:
      chat:
        $ref: '#/definitions/domain.WebhookChatInfo'
      from:
        $ref: '#/definitions/domain.UserInfo'
      text:
        type: string
    type: object
  domain.UserInfo:
    properties:
      first_name:
        type: string
      last_name:
        type: string
      user_id:
        type: string
    type: object
  domain.WebhookChatInfo:
    properties:
      chat_id:
        type: integer
      type:
        type: string
    type: object
info:
  contact: {}
paths:
  /me:
    get:
      consumes:
      - application/json
      description: Get bot name and add bot link
      produces:
      - application/json
      responses:
        "200":
          description: Bot information
          schema:
            $ref: '#/definitions/BotInfoResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Get bot information
      tags:
      - Bot
  /monitoring/profiles/coverage:
    get:
      consumes:
      - application/json
      description: Get metrics about profile data coverage
      produces:
      - application/json
      responses:
        "200":
          description: Profile coverage metrics
          schema:
            $ref: '#/definitions/ProfileCoverageResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Get profile coverage metrics
      tags:
      - Monitoring
  /monitoring/profiles/quality:
    get:
      consumes:
      - application/json
      description: Get detailed report about profile data quality
      produces:
      - application/json
      responses:
        "200":
          description: Profile quality report
          schema:
            $ref: '#/definitions/ProfileQualityReportResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Get profile quality report
      tags:
      - Monitoring
  /monitoring/webhook/stats:
    get:
      consumes:
      - application/json
      description: Get statistics about webhook event processing
      parameters:
      - description: Time period (hour, day, week, month)
        in: query
        name: period
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Webhook statistics
          schema:
            $ref: '#/definitions/WebhookStatsResponse'
        "400":
          description: Invalid period parameter
          schema:
            $ref: '#/definitions/ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Get webhook processing statistics
      tags:
      - Monitoring
  /profiles/{user_id}:
    get:
      consumes:
      - application/json
      description: Get user profile information by user ID
      parameters:
      - description: User ID
        in: path
        name: user_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: User profile
          schema:
            $ref: '#/definitions/ProfileResponse'
        "400":
          description: Invalid user ID
          schema:
            $ref: '#/definitions/ErrorResponse'
        "404":
          description: Profile not found
          schema:
            $ref: '#/definitions/ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Get user profile
      tags:
      - Profile
    put:
      consumes:
      - application/json
      description: Update user profile information
      parameters:
      - description: User ID
        in: path
        name: user_id
        required: true
        type: string
      - description: Profile updates
        in: body
        name: profile
        required: true
        schema:
          $ref: '#/definitions/ProfileUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Updated profile
          schema:
            $ref: '#/definitions/ProfileResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Update user profile
      tags:
      - Profile
  /profiles/{user_id}/name:
    post:
      consumes:
      - application/json
      description: Set name provided by user
      parameters:
      - description: User ID
        in: path
        name: user_id
        required: true
        type: string
      - description: User-provided name
        in: body
        name: name
        required: true
        schema:
          $ref: '#/definitions/SetNameRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Updated profile
          schema:
            $ref: '#/definitions/ProfileResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Set user-provided name
      tags:
      - Profile
  /profiles/stats:
    get:
      consumes:
      - application/json
      description: Get statistics about user profiles
      produces:
      - application/json
      responses:
        "200":
          description: Profile statistics
          schema:
            $ref: '#/definitions/ProfileStatsResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Get profile statistics
      tags:
      - Profile
  /webhook/max:
    post:
      consumes:
      - application/json
      description: Process incoming webhook events from MAX Messenger
      parameters:
      - description: Webhook event
        in: body
        name: event
        required: true
        schema:
          $ref: '#/definitions/domain.MaxWebhookEvent'
      produces:
      - application/json
      responses:
        "200":
          description: Event processed successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Invalid request body
          schema:
            $ref: '#/definitions/ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/ErrorResponse'
      summary: Handle MAX webhook events
      tags:
      - Webhook
swagger: "2.0"
