# API пагинации, сортировки и поиска сотрудников

## Обзор

Эндпоинт `/employees/all` теперь поддерживает расширенные возможности:
- **Пагинация** - разбиение результатов на страницы
- **Сортировка** - упорядочивание по любому полю в порядке возрастания или убывания
- **Поиск** - фильтрация по всем полям сотрудника

## Эндпоинт

```
GET /employees/all
```

## Параметры запроса

| Параметр | Тип | Обязательный | По умолчанию | Описание |
|----------|-----|--------------|--------------|----------|
| `limit` | int | Нет | 50 | Количество записей на странице (максимум 100) |
| `offset` | int | Нет | 0 | Смещение от начала результатов |
| `sort_by` | string | Нет | last_name | Поле для сортировки |
| `sort_order` | string | Нет | asc | Порядок сортировки (asc/desc) |
| `search` | string | Нет | - | Поисковый запрос |

### Доступные поля для сортировки

- `id` - ID сотрудника
- `first_name` - Имя
- `last_name` - Фамилия  
- `middle_name` - Отчество
- `phone` - Телефон
- `max_id` - MAX ID
- `inn` - ИНН
- `kpp` - КПП
- `role` - Роль
- `university` - Название университета
- `created_at` - Дата создания
- `updated_at` - Дата обновления

## Формат ответа

```json
{
  "data": [
    {
      "id": 1,
      "first_name": "Иван",
      "last_name": "Иванов",
      "middle_name": "Иванович",
      "phone": "+79001234567",
      "max_id": "max_123456",
      "inn": "1234567890",
      "kpp": "123456789",
      "role": "curator",
      "user_id": 1,
      "max_id_updated_at": "2023-12-10T10:00:00Z",
      "university_id": 1,
      "university": {
        "id": 1,
        "name": "МГУ",
        "inn": "1234567890",
        "kpp": "123456789",
        "created_at": "2023-12-10T09:00:00Z",
        "updated_at": "2023-12-10T09:00:00Z"
      },
      "created_at": "2023-12-10T09:30:00Z",
      "updated_at": "2023-12-10T10:00:00Z"
    }
  ],
  "total": 150,
  "limit": 50,
  "offset": 0,
  "total_pages": 3
}
```

### Поля ответа

- `data` - Массив сотрудников
- `total` - Общее количество записей (с учетом поиска)
- `limit` - Лимит записей на странице
- `offset` - Текущее смещение
- `total_pages` - Общее количество страниц

## Примеры использования

### Базовая пагинация

```bash
# Первая страница (50 записей)
GET /employees/all

# Вторая страница
GET /employees/all?limit=50&offset=50

# Третья страница с лимитом 20
GET /employees/all?limit=20&offset=40
```

### Сортировка

```bash
# Сортировка по фамилии (по умолчанию)
GET /employees/all?sort_by=last_name&sort_order=asc

# Сортировка по имени в убывающем порядке
GET /employees/all?sort_by=first_name&sort_order=desc

# Сортировка по дате создания (новые первыми)
GET /employees/all?sort_by=created_at&sort_order=desc

# Сортировка по университету
GET /employees/all?sort_by=university&sort_order=asc
```

### Поиск

```bash
# Поиск по имени
GET /employees/all?search=Иван

# Поиск по фамилии
GET /employees/all?search=Иванов

# Поиск по телефону
GET /employees/all?search=+7900

# Поиск по университету
GET /employees/all?search=МГУ

# Поиск по ИНН
GET /employees/all?search=1234567890
```

### Комбинированные запросы

```bash
# Поиск с сортировкой
GET /employees/all?search=Иван&sort_by=last_name&sort_order=asc

# Поиск с пагинацией
GET /employees/all?search=МГУ&limit=10&offset=0

# Полный запрос
GET /employees/all?search=куратор&sort_by=created_at&sort_order=desc&limit=25&offset=0
```

## Особенности поиска

Поиск выполняется по следующим полям:
- Имя сотрудника
- Фамилия сотрудника  
- Отчество сотрудника
- Название университета
- Номер телефона
- MAX ID
- ИНН
- КПП
- Роль

Поиск **не чувствителен к регистру** и использует частичное совпадение (LIKE '%query%').

## Коды ответов

- `200 OK` - Успешный запрос
- `400 Bad Request` - Некорректные параметры запроса
- `500 Internal Server Error` - Внутренняя ошибка сервера

## Ограничения

- Максимальный лимит записей на странице: 100
- Минимальный лимит: 1 (по умолчанию 50)
- Минимальное смещение: 0
- Поиск работает только с непустыми строками

## Производительность

- Для больших объемов данных рекомендуется использовать пагинацию
- Поиск по индексированным полям (id, phone, max_id) выполняется быстрее
- Сортировка по полям с индексами также оптимизирована